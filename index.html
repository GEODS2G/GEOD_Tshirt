<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commande T-shirt GEOD</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    background: #f0f0f0;
    padding-bottom: 60px;
  }
  .background-blur {
    position: fixed;
    inset: 0;
    background: url('https://i.imgur.com/iYKlO99.jpg') center/cover no-repeat;
    filter: blur(8px);
    z-index: -1;
  }
  h2 {
    text-align: center;
    color: white;
    margin: 10px 0;
    text-shadow: 1px 1px 3px black;
    font-size: 20px;
  }
  .container {
    width: 92%;
    max-width: 420px;
    margin: auto;
    background: rgba(255,255,255,0.4);
    padding: 12px 14px;
    border-radius: 8px;
    box-shadow: 0 0 6px rgba(0,0,0,0.3);
    box-sizing: border-box;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .pair {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1 1 48%;
    min-width: 130px;
  }
  .pair.full { flex: 1 1 100%; }
  label {
    font-size: 16px;
    white-space: nowrap;
    flex: 0 0 60px;
    text-align: left;
    margin-left: 2px;
  }
  input, select, textarea {
    flex: 1;
    min-width: 0;
    padding: 5px;
    font-size: 13px;
    border-radius: 4px;
    border: 1px solid #bbb;
    box-sizing: border-box;
  }
  textarea { width: 100%; resize: none; }
  .preview-box {
    margin-top: 4px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 0 4px rgba(0,0,0,0.2);
    padding: 6px;
    text-align: center;
  }
  .preview-box img { width: 100%; border-radius: 6px; }
  button {
    width: 100%;
    margin-top: 4px;
    padding: 9px;
    font-size: 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:disabled { background: #999; cursor: not-allowed; }

  /* Modal avec animation */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0,0,0,0.5); 
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .modal.show {
    display: block;
    opacity: 1;
  }
  .modal-content {
    background-color: #fff;
    margin: 15% auto; 
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 350px;
    text-align: center;
    transform: translateY(-20px);
    transition: transform 0.3s ease;
  }
  .modal.show .modal-content {
    transform: translateY(0);
  }
  .modal-content button {
    margin-top: 12px;
    width: auto;
    padding: 8px 16px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  /* Mobile responsive : garder champs sur la même ligne */
  @media (max-width: 420px) {
    .row {
      flex-direction: row; /* garder les champs sur la même ligne */
      flex-wrap: wrap;
      gap: 6px;
    }
    .pair {
      flex: 1 1 48%;
      min-width: 120px;
    }
    label { font-size: 16px; flex: 0 0 60px; }
  }
</style>
</head>
<body>
<div class="background-blur"></div>
<h2>Commande T-shirt GEOD</h2>

<div class="container">
<form id="commandeForm">

  <div class="row">
    <div class="pair"><label for="nom">Nom</label><input id="nom" name="nom" placeholder="Ex: Dupont" required></div>
    <div class="pair"><label for="prenom">Prénom</label><input id="prenom" name="prenom" placeholder="Ex: Marie" required></div>
  </div>

  <div class="pair full"><label for="email">Email</label><input id="email" type="email" name="email" placeholder="Ex: email@mail.com" required></div>
  <div class="pair full"><label for="rue">Rue</label><input id="rue" name="rue" placeholder="Ex: 12 rue Exemple" required></div>

  <div class="row">
    <div class="pair"><label for="code_postal">CP</label><input id="code_postal" name="code_postal" placeholder="Ex: 75001" required></div>
    <div class="pair"><label for="ville">Ville</label><input id="ville" name="ville" placeholder="Ex: Paris" required></div>
  </div>

  <div class="row">
    <div class="pair"><label for="modele">Modèle</label>
      <select id="modele" name="modele" required>
        <option value="">--</option>
        <option value="T-shirt homme Fruit of the Loom">T-shirt homme Fruit of the Loom</option>
        <option value="T-shirt femme Fruit of the Loom">T-shirt femme Fruit of the Loom</option>
        <option value="Débardeur femme Fruit of the Loom">Débardeur femme Fruit of the Loom</option>
      </select>
    </div>
    <div class="pair"><label for="style">Style</label>
      <select id="style" name="style" required>
        <option value="">--</option>
        <option value="GEOD couverture CD">GEOD couverture CD</option>
        <option value="Short to ground">Short to ground</option>
        <option value="Blue lady">Blue lady</option>
        <option value="Conspiracy">Conspiracy</option>
        <option value="Rattlesnake's stone">Rattlesnake's stone</option>
        <option value="More">More</option>
      </select>
    </div>
  </div>

  <div class="preview-box" id="previewBox">
    <img id="previewImage" src="https://i.imgur.com/iYKlO99.jpg" alt="Prévisualisation">
  </div>

  <div class="row">
    <div class="pair"><label for="taille">Taille</label>
      <select id="taille" name="taille" required>
        <option value="">--</option>
        <option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option>
      </select>
    </div>
    <div class="pair"><label for="quantite">Qté</label>
      <input id="quantite" type="number" name="quantite" value="1" min="1" required>
    </div>
  </div>

  <div class="pair full"><label for="remarques">Remarques</label>
    <textarea id="remarques" name="remarques" rows="2" placeholder="Ex : demande spéciale, contact, etc."></textarea>
  </div>

  <button type="submit">Envoyer la commande</button>
</form>
</div>

<!-- Modal -->
<div id="confirmationModal" class="modal">
  <div class="modal-content">
    <p>✅ Commande enregistrée. Veuillez vous rapprocher d’un membre du staff pour payer votre commande.</p>
    <button id="closeModal">OK</button>
  </div>
</div>

<script>
let envoiEnCours = false;

const idMap = {
  "debardeur_blue_lady":"https://i.imgur.com/Hdqhv78.jpg",
  "debardeur_conspiracy":"https://i.imgur.com/WX8ct1w.jpg",
  "debardeur_geod_couverture_cd":"https://i.imgur.com/gBWuJXJ.jpg",
  "debardeur_more":"https://i.imgur.com/OTo04mh.jpg",
  "debardeur_rattlesnakes_stone":"https://imgur.com/Gt6gKGS",
  "debardeur_short_to_ground":"https://i.imgur.com/7ZzqV6o.jpg",
  "femme_blue_lady":"https://i.imgur.com/4cb4Ysa.jpg",
  "femme_conspiracy":"https://i.imgur.com/bzjcXWW.jpg",
  "femme_geod_couverture_cd":"https://i.imgur.com/qRsypOr.jpg",
  "femme_more":"https://i.imgur.com/swfdD2w.jpg",
  "femme_rattlesnakes_stone":"https://imgur.com/USjaozL",
  "femme_short_to_ground":"https://i.imgur.com/6aij7nd.jpg",
  "homme_blue_lady":"https://i.imgur.com/eTcuvEQ.jpg",
  "homme_conspiracy":"https://i.imgur.com/gmlqMG4.jpg",
  "homme_geod_couverture_cd":"https://i.imgur.com/ElmFdIk.jpg",
  "homme_more":"https://i.imgur.com/yI4UWr7.jpg",
  "homme_rattlesnakes_stone":"https://imgur.com/dMzubO6",
  "homme_short_to_ground":"https://i.imgur.com/5cDO1p3.jpg"
};

function getImageUrl(m,s){
  const map={"T-shirt homme Fruit of the Loom":"homme","T-shirt femme Fruit of the Loom":"femme","Débardeur femme Fruit of the Loom":"debardeur"};
  const mk=map[m]; if(!mk) return null;
  const sk=s.toLowerCase().replace(/'/g,'').replace(/ /g,'_').normalize("NFD").replace(/[\u0300-\u036f]/g,'');
  return idMap[`${mk}_${sk}`]||null;
}

function updatePreview(){
  const m=document.querySelector('select[name="modele"]').value;
  const s=document.querySelector('select[name="style"]').value;
  const url=getImageUrl(m,s);
  document.getElementById("previewImage").src = url || "https://i.imgur.com/iYKlO99.jpg";
}

document.querySelector('select[name="modele"]').addEventListener('change',updatePreview);
document.querySelector('select[name="style"]').addEventListener('change',updatePreview);

// Modal functions
function showModal() {
  const modal = document.getElementById("confirmationModal");
  modal.style.display = "block";
  setTimeout(() => modal.classList.add("show"), 10); // trigger animation
}

function closeModal() {
  const modal = document.getElementById("confirmationModal");
  modal.classList.remove("show");
  setTimeout(() => { modal.style.display = "none"; }, 300);
}

document.getElementById("closeModal").addEventListener("click", closeModal);

document.getElementById('commandeForm').addEventListener('submit', function(e){
  e.preventDefault();
  if(envoiEnCours) return;
  envoiEnCours = true;

  const b = e.target.querySelector("button");
  b.textContent = "Envoi...";
  b.disabled = true;

  const formData = new FormData(e.target);
  fetch("https://script.google.com/macros/s/AKfycbxsIPjoY4oe46XGpRWeh1MrnA2rhSbVLZZumHIblqbKXXnS4CHlTk8Hc6-pZP5yZMWFDQ/exec",{method:"POST",body:formData})
  .then(r => r.text()).then(() => {
    showModal(); // pop-up animé

    // Réinitialiser uniquement Modèle / Style / Taille / Qté / Remarques
    e.target.querySelector('select[name="modele"]').value = "";
    e.target.querySelector('select[name="style"]').value = "";
    e.target.querySelector('select[name="taille"]').value = "";
    e.target.querySelector('input[name="quantite"]').value = 1;
    e.target.querySelector('textarea[name="remarques"]').value = "";
    updatePreview();

    b.textContent = "Envoyer la commande";
    b.disabled = false;
    envoiEnCours = false;
  }).catch(err=>{
    alert("Erreur d'envoi");
    console.error(err);
    b.textContent = "Envoyer la commande";
    b.disabled = false;
    envoiEnCours = false;
  });
});
</script>
</body>
</html>


